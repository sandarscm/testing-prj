##############################################################################################
##
#  PHP新着情報、お知らせプログラムNews02（画像アップ・エディタ機能搭載版）ver1.0.1 (2013.07.22公開)
#
#  トップーページの新着情報やお知らせなどに適しています。
#　インラインフレームでも良いですが、トップページに直接埋め込むことでSEOにも効果的です。
#  改造や改変は自己責任で行ってください。
#	
#  今のところ特に問題点はありませんが、不具合等がありましたら下記までご連絡ください。
#  MailAddress: info@php-factory.net
#  name: k.numata
#  HP: http://www.php-factory.net/
##
##############################################################################################

■主な機能
・個人・商用問わずどんなサイトでも使用可能なフリーウェアです。
・管理画面からブログ感覚で新着情報やお知らせなどを投稿できるCMSです。
・クライアントが投稿することを想定し、分かりやすく、ミスしずらいよう高機能かつシンプル仕様
・記事投稿に加え記事内に画像（jpg,gif,pngのみ）を投稿可能。サイズも自動縮小します。デフォルトは400px。要GDライブラリ
・本文入力箇所にエディタを導入し、文字色、サイズ、センタリング、左右寄せ、リンク設定などが行える。
・本文にURLのみを記述すれば任意のページに直接リンクさせることも可能。（既存のページに飛ばしたい場合などに便利）
・表示・非表示が可能。
・バックアップファイルを自動生成（デフォルトはOFF）新規投稿時にバックアップを作成します。
・すべての設定はconfig.phpで行えます。
・デフォルトでは詳細画面をポップアップしますが、既存のサイトのページに詳細を表示させることも可能。サイトにサンプルあります。
※要カスタマイズ　有償にて承ることも可能です。

v1.0.1 新機能
・万が一に備えデータファイルのバックアップをメールで添付送信できます。（新規投稿時に送信します）
・日付の表示形式を様々な形で表示可能
・画像を複数アップ可能に（多くとも5枚程度が無難）
・スマホ、携帯（ガラケー）用のファイルを追加しました。3デバイス同時更新が可能です。
・最新の記事にはNEW!マークを表示。表示期間は設定ファイルで設定可能です。
　ソースコード内以下の箇所
　if($new_mark = new_mark_func($lines_array[1],'<span style="color:red;font-size:12px;" class="new_mark"> NEW !</span>'));
　でタグ、テキストを変更可能。もちろん画像もOKです。

■動作環境
PHPバージョン4〜（5.3まで動作確認済）
PHP GDライブラリ ※画像の自動縮小に使います。これが無いと動きません。がほとんどのサーバーでは入っているはずです。
入ってない場合は諦めてください・・・。
または画像アップ部分を管理画面から削除すれば使うことが可能です。
管理画面では文字装飾用の特殊エディタを使用しています。これはブラウザに依存する機能になり、
一部ブラウザではうまく動作しないかもしれません。

推奨ブラウザ：IE（8以上）、Firefox、GoogleChrome（Mac環境では動作テストしておりません）

■ 設置方法
※こちらの情報が最新では無い可能性がありますので設置法はできればサイトにてご確認ください。

ファイルの文字コードは基本的にUTF-8です。必ず対応したエディタで開いてください。
メモ帳（UTF-8非対応）は使用禁止です。ファイルが壊れます。TeraPad（無料）やDreamWeaver等で開いてください。
DWだとコードに色付けされ分かりやすいのでおすすめです。
※ PHPでは、スラッシュ2回「//」の後からその行の末尾までがコメント扱いとなります。コード内に複数あります。「#」もです。

	1.  解凍後のファイル構成

	umekomi.php ・・・ 一覧をトップページに直接埋め込む場合はこちらのコードの一部（ソース内に書いてます）をトップページの任意の場所に貼り付けてください。

	Readme.txt ・・・ このファイル

	photo_news/ ※ディレクトリ名は変更可能です（変更した場合、埋め込みした部分にあるパスを要変更 ※photo_news/ ＝ 変更後のフォルダ名）

	  └ index.php ・・・ 新着情報の一覧ページ
	  （一覧をインラインフレームで読み込む場合はこれを読み込んでください。携帯、スマホはこのファイルにリンクさせてもいいかもしれません。埋め込みの場合このファイルは必要ありません）

	  └ popup.php ・・・ 新着情報の詳細ページ
	  （詳細は記述すれば自動的にポップアップが設定され、こちらのページが表示されます。htmlやcssの編集は自由に行なってください）

	  └ admin.php ・・・ 管理ページ 投稿や編集、削除などを行えます。

	  └ config.php ・・・ 設定ファイル。管理画面ログイン情報の設定やその他設定、関数記述など

	  └ style.css ・・・ admin.php、index.php、popup.phpのスタイルを記述(もちろん独自のCSSでもOKです)

	      └ data/news.dat ・・・ 新着情報のデータを格納するファイル（パーミッション666等書き込み可能なものに）

	      └ upimg/ ・・・ 画像データの保存先ディレクトリです。（パーミッションを書き込み可能なものに。705、777等。詳細はサーバマニュアルを参照ください）

	      └ editor/ ・・・ 本文入力箇所の文字装飾などのためのJSファイルが入っています。特に触る必要ありません。そっとしておきましょう・・

	2. ユーザID、パスワードを設定する
		config.phpをエディタソフトで開き、ログインのためのID、パスワードを変更してください。
		初期値は 
		ID：admin
		パスワード：1397
		になっています。必ず変更してください。その他必要に応じてコメントを参考に設定してください。
	
	3. FTPでアップ
		photo_newsフォルダごと（全ファイル）アップし、「data」、「upimg」ディレクトリのパーミッションを707 or 777に設定（詳しくはサーバのマニュアルなどを参照ください）し、
		data/news.datのパーミッションを書き込み可能な666等にしてください。
		これで完了です。

	4.ブラウザで確認
		「あなたのサイトのURL」/photo_news/admin.phpを表示し、管理画面にログイン後、投稿を行ってみてください。正常に登録、編集できればOKです。
		トップページに埋め込んだ場合はトップページ、インラインフレームで読み込む場合はphoto_news/index.phpを確認してください。
		投稿データが反映されていればOKです。インラインフレームの場合はphoto_news/index.phpをトップの任意の場所で読み込めばOKです。
		iframeタグ例　<iframe src="photo_news/" width="600" height="130" frameborder="0"></iframe>

	5. ページの調整
		必要に応じてスタイルシート、HTML等で見た目の調整を行ってください。

		
■ 更新履歴
-----------------------------------------------------------------------------------------------------------------------
2014.02.03 本文入力箇所でIE11で不具合が発生していたものを修正しました。
2013.09.09 ソースコードの可読性、汎用性向上のため全体的な見直しと修正（関数化）などを行いました。
2013.09.05 新バージョンにて「記事表示数」で非表示に設定した記事分もカウントしてしまっていたものを修正しました。 
2013.08.02 IE8以下の場合に、管理画面の「編集・削除」ボタンが押せない状態となっていたものを修正しました（7/22〜8/2に配布していたもの）
2013.07.21 v1.0.1の配布を開始しました。新機能、ソースコードの全体的な修正など。
2013.07.13 登録上限数を「無制限」に設定すると、既存のデータが消えてしまう不具合を修正しました。
2013.02.13 ポップアップページにて「UTF-8」以外（SJIS、EUC-JP）に変更された場合に文字化けが発生する不具合を修正しました。
2013.01.17 布中のプログラムにて本文内に入力した半角英字の大文字が小文字に変換されてしまっていたものを修正しました。
2013.01.13　v1.0.0　既存のニュースプログラムに画像アップ、エディタ機能（テキスト装飾機能）などを追加し、上位版として配布開始


■ご利用規約

・無料版プログラムはフリーウェアです。ただし、著作権は放棄するものではありません。
　また、カスタマイズ依頼、著作権表示削除依頼にて表示を削除したとしても著作権は放棄しません。
・プログラムによって何らかの不利益、損害が生じても一切の責任を負いません。
　あらかじめご了承の上ご使用ください。
　もし何らかのトラブルがあった場合には、ご相談いただければ解決策が見つかるかもしれません。
　（クライアントへの原因の説明など）
・プログラムは全ての環境（サーバー）での動作を保証するものではありません。
・プログラムの著作権表示を削除することはできません。（削除依頼をいただいた場合を除く）
・改変等は自己責任でお願いします。
・プログラムの再配布は禁止しております。
　ダウンロードいただいた時点で利用規約に同意したものとみなされます。

■著作権表示削除について

著作権表示の削除には1サイトあたり2,000円の使用料金が必要になります。
2サイト目以降は都度料金が必要になります。無断で削除された場合、動作の保証は致し兼ねますのでご了承下さい。
ご希望の際はURLにてご連絡をお願いいたします。

振込先をお送りいたしますので、そちらにご入金後こちらから必要なファイルを送付させていただきます。
※正常に動作することをご確認後、申請を行なってください。初期不良以外入金後の返金は致しかねますのでご了承ください。

問題等が発生した場合は相談してみてください。解決策が見つかるかもしれません。
基本的にはデータが保存された「news.dat」または自動生成のバックアップファイルさえあればなんとでもなります。

■カスタマイズ、設置代行について

PC、携帯、スマホサイトへの設置代行（各3,000円）、カスタマイズ（3,000円〜）にも対応いたしますのでご相談ください。
実装が難しいもの、まったく違うものに作り変えるなどは対応出来かねる場合もございます。

また、たとえば現在のサイトのデザインが反映されたページに詳細を表示させたいなども可能です。
お問い合わせは下記とりお願いいたします。

+++------------------------------------+
PHP工房 各種お問い合わせ
http://www.php-factory.net/
+------------------------------------+++
